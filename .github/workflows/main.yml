image: cirrusci/flutter:stable

stages:
  - analyze
    - test

    analyze:
      stage: analyze
        script:
            - flutter pub get
                - flutter analyze

                test:
                  stage: test
                    script:
                        - flutter test
                        ```

                        ---

                        ## üß™ B∆∞·ªõc 2: Th√™m b√°o c√°o JUnit

                        ### C√†i ƒë·∫∑t th√™m `tojunit`:

                        ```bash
                        flutter pub global activate junitreport
                        ```

                        ### C·∫≠p nh·∫≠t file `.gitlab-ci.yml`:

                        ```yaml
                        test:
                          stage: test
                            script:
                                - flutter pub global activate junitreport
                                    - flutter test --machine | tojunit > report.xml
                                      artifacts:
                                          reports:
                                                junit: report.xml
                                                    paths:
                                                          - report.xml
                                                          ```

                                                          ---

                                                          ## üìä B∆∞·ªõc 3: Th√™m b√°o c√°o Code Coverage

                                                          ### C·∫≠p nh·∫≠t `.gitlab-ci.yml`:

                                                          ```yaml
                                                          coverage:
                                                            stage: test
                                                              script:
                                                                  - flutter test --coverage
                                                                      - genhtml coverage/lcov.info -o coverage
                                                                        artifacts:
                                                                            paths:
                                                                                  - coverage/lcov.info
                                                                                        - coverage/index.html
                                                                                        ```

                                                                                        ### (T√πy ch·ªçn) C√†i th√™m c√¥ng c·ª•:

                                                                                        ```bash
                                                                                        sudo apt-get install lcov
                                                                                        sudo apt-get install genhtml
                                                                                        ```

                                                                                        ---

                                                                                        ## üì¶ B∆∞·ªõc 4: Build APK v√† App Bundle

                                                                                        Th√™m c√°c stage build:

                                                                                        ```yaml
                                                                                        build_apk:
                                                                                          stage: build
                                                                                            script:
                                                                                                - flutter build apk --release
                                                                                                  artifacts:
                                                                                                      paths:
                                                                                                            - build/app/outputs/flutter-apk/app-release.apk

                                                                                                            build_appbundle:
                                                                                                              stage: build
                                                                                                                script:
                                                                                                                    - flutter build appbundle --release
                                                                                                                      artifacts:
                                                                                                                          paths:
                                                                                                                                - build/app/outputs/bundle/release/app-release.aab
                                                                                                                                ```

                                                                                                                                ---

                                                                                                                                ## üìö B∆∞·ªõc 5: G·ª£i √Ω b√†i t·∫≠p cho sinh vi√™n

                                                                                                                                | B√†i t·∫≠p                                        | M·ª•c ti√™u             |
                                                                                                                                | ---------------------------------------------- | -------------------- |
                                                                                                                                | T·∫°o pipeline `analyze` + `test`                | L√†m quen CI          |
                                                                                                                                | Xu·∫•t b√°o c√°o JUnit                             | X·ª≠ l√Ω artifacts      |
                                                                                                                                | Th√™m b√°o c√°o code coverage                     | Ki·ªÉm so√°t ch·∫•t l∆∞·ª£ng |
                                                                                                                                | Build APK/App Bundle                           | Tri·ªÉn khai th·ª±c t·∫ø   |
                                                                                                                                | (N√¢ng cao) Deploy l√™n Firebase ho·∫∑c Play Store | K·∫øt h·ª£p Fastlane     |

                                                                                                                                ---

                                                                                                                                ## üí° T√†i nguy√™n tham kh·∫£o

                                                                                                                                * [cirrusci/flutter Docker Image](https://hub.docker.com/r/cirrusci/flutter)
                                                                                                                                * [GitLab CI/CD Flutter Example](https://docs.gitlab.com/ee/ci/examples/)
                                                                                                                                * [JUnit Report via tojunit](https://pub.dev/packages/junitreport)
                                                                                                                                * [Coverage in Flutter CI/CD](https://blog.flutter.wtf/flutter-test-coverage-via-gitlab-ci-cd)
                                                                                                                                * [Medium - Flutter CI/CD with GitLab](https://medium.com/@tendallas/flutter-ci-cd-with-gitlab-da93edabbc93)

                                                                                                                                ---

                                                                                                                                ## ‚úÖ K·∫øt lu·∫≠n

                                                                                                                                Pipeline GitLab gi√∫p t·ª± ƒë·ªông h√≥a ki·ªÉm th·ª≠ v√† build ·ª©ng d·ª•ng Flutter hi·ªáu qu·∫£. Sinh vi√™n c√≥ th·ªÉ √°p d·ª•ng t·ª´ng b∆∞·ªõc ƒë·ªÉ hi·ªÉu r√µ c√°ch ho·∫°t ƒë·ªông c·ªßa CI/CD v√† v·∫≠n d·ª•ng v√†o d·ª± √°n th·ª±c t·∫ø.

                                                                                                                              
